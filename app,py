import os, requests
from flask import Flask, request, Response

app = Flask(__name__)
API_KEY = os.environ.get("API_DATA_GOV_KEY", "")

@app.after_request
def add_cors(resp):
    resp.headers["Access-Control-Allow-Origin"] = "*"
    return resp

@app.get("/echo")
def echo():
    params = dict(request.args)
    params["output"] = "JSON"
    if API_KEY:
        params["api_key"] = API_KEY

    r = requests.get(
        "https://echo.epa.gov/echo/rest_services.get_facility_info",
        params=params,
        timeout=30
    )
    # Pass the raw JSON straight through
    return Response(r.content, status=r.status_code, content_type="application/json")
